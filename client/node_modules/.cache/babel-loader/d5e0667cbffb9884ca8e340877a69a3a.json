{"ast":null,"code":"var _jsxFileName = \"/home/giorgir/Desktop/web projects/discord-mern/client/src/components/Chat/Chat.js\";\nimport React, { useState, useEffect, useReducer } from 'react';\nimport { useParams, useHistory } from 'react-router-dom';\nimport axios from 'axios';\nimport FormData from 'form-data';\nimport './_chat.sass';\nimport { EditSVG, MicSVGOff, MicSVGOn, CamSVGOff, CamSVGOn, ScreenShareOff, ScreenShareOn } from '../../styles/SVGs/_SVGs';\nimport { appendFile } from './_appendFile';\nimport { getBasicData } from '../js/_getBasicData';\nimport * as socks from '../js/_socketSide'; // import { WebRTCFrame } from '../WebRTCInteractive/WebRTCInteractive';\n\nimport { VoiceFrame } from '../Voice/_voice';\nimport { PopupEditCat, PopupAddCat } from './_editCat';\n\nconst checkRoomId = (roomId, setCategory, history, setVoiceMode) => {\n  if (roomId === undefined) history.push(\"/chat/61ed960432479c682956802b\"); // roomId = \"61ed960432479c682956802b\";\n\n  axios.post(\"/api/roomId\", {\n    id: roomId\n  }).then(res => {\n    if (res.data.roomName != \"try_again\") {\n      setCategory(res.data.roomName);\n      if (res.data.voiceMode) setVoiceMode(true);\n    } else {\n      history.push(\"/chat/61ed960432479c682956802b\"); // roomId = \"61ed960432479c682956802b\";\n\n      setCategory(\"room 1\");\n      setVoiceMode(false);\n    }\n  }).catch(err => console.error(err));\n};\n\nconst logOut = (e, history) => {\n  e.preventDefault();\n  axios.post(\"/api/users/logout\", {\n    junk: \"\"\n  }).then(res => {\n    if (res.data.status === \"done\") history.push(\"/\");\n  }).catch(err => console.error(err));\n  socks.disconnect();\n};\n\nconst newMessage = (user, msg, date) => /*#__PURE__*/React.createElement(\"div\", {\n  className: \"element\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 5\n  }\n}, /*#__PURE__*/React.createElement(\"div\", {\n  className: \"author\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 55,\n    columnNumber: 9\n  }\n}, user), /*#__PURE__*/React.createElement(\"div\", {\n  className: \"message\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 9\n  }\n}, msg.split(\"\\n\").map(line => /*#__PURE__*/React.createElement(\"div\", {\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 42\n  }\n}, line))), /*#__PURE__*/React.createElement(\"div\", {\n  className: \"date\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 61,\n    columnNumber: 9\n  }\n}, date));\n\nconst CategoriesJSX = ({\n  cats,\n  display,\n  setDisplay,\n  setElementId\n}) => cats.map(cat => /*#__PURE__*/React.createElement(\"li\", {\n  className: \"category\",\n  id: cat._id,\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 68,\n    columnNumber: 21\n  }\n}, /*#__PURE__*/React.createElement(\"a\", {\n  href: `/chat/${cat._id}`,\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 9\n  }\n}, \"# \", cat.name), /*#__PURE__*/React.createElement(EditSVG, {\n  id: cat._id,\n  display: display,\n  setDisplay: setDisplay,\n  setElementId: setElementId,\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 70,\n    columnNumber: 9\n  }\n})));\n\nconst Chat = () => {\n  const Categories = () =>\n  /*#__PURE__*/\n  // { user, cats, displayEdit, setDisplayEdit, displayAdd, setDisplayAdd, setElementId}\n  React.createElement(\"div\", {\n    className: \"categories\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"top\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"topbar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    className: \"user\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 21\n    }\n  }, userName), /*#__PURE__*/React.createElement(\"h1\", {\n    className: \"plus\",\n    onClick: () => setDisplayAdd(!displayAdd),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 21\n    }\n  }, \"+\")), /*#__PURE__*/React.createElement(\"nav\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"ul\", {\n    id: \"ul-id\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(CategoriesJSX, {\n    cats: catjson,\n    display: displayEdit,\n    setDisplay: setDisplayEdit,\n    setElementId: setElementId,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 25\n    }\n  })))));\n\n  const Messages = () => {\n    // { authentication, room, roomId, elements, user }\n    const sendFile = () => {\n      // sendFile(e.target.files[0])\n      let file = selectedFile;\n      console.log(\"shit\", file); // const formData = new FormData();\n      // formData.append(\"user\", userName);\n      // // formData.append(\"time\", \"00:00\");\n      // formData.append(\"size\", file.size); // in bites\n      // // let fileF = \"\";\n      // formData.append(\"file\", selectedFile, file.name);\n      // axios.post(\"/upload\", formData)\n      //      .then(res => {\n      //         console.log(\"Successfully Uploaded...\");\n      //      })\n      //      .catch(err => alert(err));\n    };\n\n    const [selectedFile, setSelectedFile] = useState(null);\n    useEffect(() => {\n      if (selectedFile != null) sendFile();\n    }, [selectedFile]);\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n      id: \"chat-screen\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 13\n      }\n    }, elements.map(el => newMessage(el.user, el.msg, el.date)), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"last-element\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 17\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"input\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"textarea\", {\n      id: \"text-area\",\n      type: \"text\",\n      placeholder: `Message #${category}`,\n      onKeyPress: e => socks.sendMessage(e, userName, category, roomId, authentication),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(\"input\", {\n      type: \"file\",\n      value: selectedFile,\n      onChange: e => setSelectedFile(e.target.files[0]),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 17\n      }\n    })));\n  };\n\n  const Center = () => /*#__PURE__*/React.createElement(\"div\", {\n    className: \"messages\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    id: \"top\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 144,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    id: \"category\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 17\n    }\n  }, \"# \", category), /*#__PURE__*/React.createElement(\"h1\", {\n    id: \"log_out\",\n    onClick: event => {\n      logOut(event, history);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 17\n    }\n  }, \"Log out\")), voiceMode ? /*#__PURE__*/React.createElement(VoiceFrame, {\n    history: history,\n    roomId: roomId,\n    userName: userName,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 15\n    }\n  }) : /*#__PURE__*/React.createElement(Messages, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 15\n    }\n  }));\n\n  const StatusBar = () =>\n  /*#__PURE__*/\n  // { online, offline }\n  React.createElement(\"div\", {\n    className: \"status-bar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 13\n    }\n  }, \"ACTIVE - \", onlineList.length), onlineList.map(el => /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"online\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 35\n    }\n  }, \"--- \", el)), /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 13\n    }\n  }, \"OFFLINE - \", offlineList.length), offlineList.map(el => /*#__PURE__*/React.createElement(\"h2\", {\n    className: \"offline\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 36\n    }\n  }, \"--- \", el)));\n\n  const reducer = (state, action) => {// pass\n  };\n\n  const initialState = {\n    setOnline: \"\",\n    setOffline: \"\",\n    onlineList: [],\n    offlineList: []\n  };\n  const [online, setOnline] = useState(\"\");\n  const [offline, setOffline] = useState(\"\");\n  const [onlineList, setOnlineList] = useState([]);\n  const [offlineList, setOfflineList] = useState([]); // const [state, dispatch] = useReducer(reducer, initialState);\n\n  let {\n    roomId\n  } = useParams();\n  const [userName, setUserName] = useState(\"\");\n  const [category, setCategory] = useState(\"\");\n  const [catjson, setCatJson] = useState([]);\n  const [authentication, setAuthentication] = useState();\n  const [element, setElement] = useState({\n    user: \"author\",\n    msg: \"message\",\n    date: \"date\"\n  });\n  const [elements, setElements] = useState([]);\n  const [displayEdit, setDisplayEdit] = useState(false);\n  const [displayAdd, setDisplayAdd] = useState(false);\n  const [elementId, setElementId] = useState();\n  const [voiceMode, setVoiceMode] = useState(false);\n  const history = useHistory();\n  useEffect(() => {\n    checkRoomId(roomId, setCategory, history, setVoiceMode);\n    getBasicData(history, setUserName, setAuthentication, setCatJson, \"chat\");\n  }, []);\n  useEffect(() => {\n    if (userName !== \"\") socks.main(category, userName, setElement, setOnline, setOffline);\n  }, [userName]);\n  useEffect(() => {\n    setElements([...elements, element]);\n  }, [element]);\n  useEffect(() => {\n    let el = document.getElementById(\"last-element\");\n    el.scrollIntoView();\n  }, [elements]);\n  useEffect(() => {\n    if (online !== \"\") {\n      let new_offlineList = offlineList.filter(element => element !== online);\n      setOfflineList(new_offlineList);\n      setOnlineList([...onlineList, online]);\n    }\n  }, [online]);\n  useEffect(() => {\n    if (offline !== \"\") {\n      let new_onlineList = onlineList.filter(element => element !== offline);\n      setOnlineList(new_onlineList);\n      setOfflineList([...offlineList, offline]);\n    }\n  }, [offline]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"chat\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 241,\n      columnNumber: 9\n    }\n  }, displayEdit ? /*#__PURE__*/React.createElement(PopupEditCat, {\n    setDisplay: setDisplayEdit,\n    catjson: catjson,\n    setCatJson: setCatJson,\n    elementId: elementId,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 243,\n      columnNumber: 13\n    }\n  }) : null, displayAdd ? /*#__PURE__*/React.createElement(PopupAddCat, {\n    setDisplay: setDisplayAdd,\n    catjson: catjson,\n    setCatJson: setCatJson,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 13\n    }\n  }) : null, /*#__PURE__*/React.createElement(Categories, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Center, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(StatusBar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 13\n    }\n  }));\n};\n\nexport default Chat;","map":{"version":3,"sources":["/home/giorgir/Desktop/web projects/discord-mern/client/src/components/Chat/Chat.js"],"names":["React","useState","useEffect","useReducer","useParams","useHistory","axios","FormData","EditSVG","MicSVGOff","MicSVGOn","CamSVGOff","CamSVGOn","ScreenShareOff","ScreenShareOn","appendFile","getBasicData","socks","VoiceFrame","PopupEditCat","PopupAddCat","checkRoomId","roomId","setCategory","history","setVoiceMode","undefined","push","post","id","then","res","data","roomName","voiceMode","catch","err","console","error","logOut","e","preventDefault","junk","status","disconnect","newMessage","user","msg","date","split","map","line","CategoriesJSX","cats","display","setDisplay","setElementId","cat","_id","name","Chat","Categories","userName","setDisplayAdd","displayAdd","catjson","displayEdit","setDisplayEdit","Messages","sendFile","file","selectedFile","log","setSelectedFile","elements","el","category","sendMessage","authentication","target","files","Center","event","StatusBar","onlineList","length","offlineList","reducer","state","action","initialState","setOnline","setOffline","online","offline","setOnlineList","setOfflineList","setUserName","setCatJson","setAuthentication","element","setElement","setElements","elementId","main","document","getElementById","scrollIntoView","new_offlineList","filter","new_onlineList"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useReducer } from 'react';\r\n\r\nimport { useParams, useHistory } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport FormData from 'form-data';\r\n\r\nimport './_chat.sass';\r\nimport { EditSVG, MicSVGOff, MicSVGOn, CamSVGOff, CamSVGOn, ScreenShareOff, ScreenShareOn } from '../../styles/SVGs/_SVGs';\r\n\r\nimport { appendFile } from './_appendFile';\r\nimport { getBasicData } from '../js/_getBasicData';\r\nimport * as socks from '../js/_socketSide';\r\n\r\n// import { WebRTCFrame } from '../WebRTCInteractive/WebRTCInteractive';\r\nimport { VoiceFrame } from '../Voice/_voice';\r\n\r\nimport { PopupEditCat, PopupAddCat } from './_editCat';\r\n\r\nconst checkRoomId = (roomId, setCategory, history, setVoiceMode) => {\r\n    if (roomId === undefined)\r\n        history.push(\"/chat/61ed960432479c682956802b\");\r\n        // roomId = \"61ed960432479c682956802b\";\r\n\r\n    axios.post(\"/api/roomId\", { id: roomId })\r\n    .then(res => {\r\n        if (res.data.roomName != \"try_again\"){\r\n            setCategory(res.data.roomName);\r\n            if (res.data.voiceMode)\r\n                setVoiceMode(true);\r\n        }\r\n        else{\r\n            history.push(\"/chat/61ed960432479c682956802b\");\r\n            // roomId = \"61ed960432479c682956802b\";\r\n            setCategory(\"room 1\");\r\n            setVoiceMode(false);\r\n        }\r\n    })\r\n    .catch(err => console.error(err));\r\n}\r\n\r\nconst logOut = (e, history) => {\r\n    e.preventDefault();\r\n    axios.post(\"/api/users/logout\", { junk: \"\" })\r\n    .then(res => {\r\n        if (res.data.status === \"done\")\r\n            history.push(\"/\");\r\n    })\r\n    .catch(err => console.error(err));\r\n\r\n    socks.disconnect();\r\n}\r\n\r\nconst newMessage = (user, msg, date) => (\r\n    <div className=\"element\">\r\n        <div className=\"author\">\r\n            {user}\r\n        </div>\r\n        <div className=\"message\">\r\n            {msg.split(\"\\n\").map(line => <div>{line}</div>)}\r\n        </div>\r\n        <div className=\"date\">\r\n           {date}\r\n        </div>\r\n    </div>\r\n)\r\n\r\nconst CategoriesJSX = ({ cats, display, setDisplay, setElementId }) =>\r\n    cats.map(cat => <li className=\"category\" id={cat._id}>\r\n        <a href={`/chat/${cat._id}`}># {cat.name}</a>\r\n        <EditSVG id={cat._id} display={display} setDisplay={setDisplay} setElementId={setElementId} />\r\n    </li>);\r\n\r\nconst Chat = () => {\r\n    const Categories = () => (\r\n        // { user, cats, displayEdit, setDisplayEdit, displayAdd, setDisplayAdd, setElementId}\r\n        <div className=\"categories\">\r\n            <div className=\"top\">\r\n                <div className=\"topbar\">\r\n                    <h1 className=\"user\">{userName}</h1>\r\n                    <h1 className=\"plus\" onClick={() => setDisplayAdd(!displayAdd)}>+</h1>\r\n                </div>\r\n    \r\n                <nav>\r\n                    <ul id=\"ul-id\">\r\n                        <CategoriesJSX cats={catjson} display={displayEdit} setDisplay={setDisplayEdit} setElementId={setElementId} />\r\n                    </ul>\r\n                </nav>\r\n            </div>\r\n        </div>\r\n    )\r\n    \r\n    const Messages = () => { // { authentication, room, roomId, elements, user }\r\n        const sendFile = () => {\r\n            // sendFile(e.target.files[0])\r\n            let file = selectedFile;\r\n            console.log(\"shit\", file);\r\n            // const formData = new FormData();\r\n            // formData.append(\"user\", userName);\r\n            // // formData.append(\"time\", \"00:00\");\r\n            // formData.append(\"size\", file.size); // in bites\r\n            // // let fileF = \"\";\r\n            // formData.append(\"file\", selectedFile, file.name);\r\n            // axios.post(\"/upload\", formData)\r\n            //      .then(res => {\r\n            //         console.log(\"Successfully Uploaded...\");\r\n            //      })\r\n            //      .catch(err => alert(err));\r\n        }\r\n\r\n        const [selectedFile, setSelectedFile] = useState(null);\r\n\r\n        useEffect(() => {\r\n            if (selectedFile != null)\r\n                sendFile();\r\n        }, [selectedFile]);\r\n\r\n        return (\r\n        <>\r\n            <div id=\"chat-screen\">\r\n                {elements.map(el => newMessage(el.user, el.msg, el.date))}\r\n                <div id=\"last-element\"></div>\r\n            </div>\r\n            <div id=\"input\">\r\n                <textarea\r\n                    id=\"text-area\"\r\n                    type=\"text\"\r\n                    placeholder={`Message #${category}`}\r\n                    onKeyPress={(e) => socks.sendMessage(e, userName, category, roomId, authentication)}\r\n                ></textarea>\r\n                {/* <svg viewBox=\"0 0 24 24\" onClick={(event) => appendFile(event)}>\r\n                    <path\r\n                    fill=\"currentColor\"\r\n                    d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z\">\r\n                    </path>\r\n                </svg> */}\r\n                <input type=\"file\" value={selectedFile} onChange={(e) => setSelectedFile(e.target.files[0])}/>\r\n            </div>\r\n        </>\r\n        );\r\n    }\r\n    \r\n    const Center = () => (\r\n        <div className=\"messages\">\r\n            <div id=\"top\">\r\n                <h1 id=\"category\"># {category}</h1>\r\n                <h1 id=\"log_out\" onClick={(event) => {logOut(event, history)}}>Log out</h1>\r\n            </div>\r\n\r\n            {voiceMode\r\n            ? <VoiceFrame history={history} roomId={roomId} userName={userName} />\r\n            : <Messages/>}\r\n        </div>\r\n    )\r\n\r\n    const StatusBar = () => ( // { online, offline }\r\n        <div className=\"status-bar\">\r\n            <h2>ACTIVE - {onlineList.length}</h2>\r\n            {onlineList.map(el => <h2 className=\"online\">--- {el}</h2>)}\r\n            <h2>OFFLINE - {offlineList.length}</h2>\r\n            {offlineList.map(el => <h2 className=\"offline\">--- {el}</h2>)}\r\n        </div>\r\n    )\r\n\r\n    const reducer = (state, action) => {\r\n        // pass\r\n    }\r\n\r\n    const initialState = {\r\n        setOnline: \"\",\r\n        setOffline: \"\",\r\n        onlineList: [],\r\n        offlineList: [],\r\n    };\r\n\r\n    const [online, setOnline] = useState(\"\");\r\n    const [offline, setOffline] = useState(\"\");\r\n    const [onlineList, setOnlineList] = useState([]);\r\n    const [offlineList, setOfflineList] = useState([]);\r\n    \r\n    // const [state, dispatch] = useReducer(reducer, initialState);\r\n\r\n    let { roomId } = useParams();\r\n\r\n    const [userName, setUserName] = useState(\"\");\r\n    const [category, setCategory] = useState(\"\");\r\n\r\n    const [catjson, setCatJson] = useState([]);\r\n    const [authentication, setAuthentication] = useState();\r\n\r\n    const [element, setElement] = useState({\r\n        user: \"author\",\r\n        msg: \"message\",\r\n        date: \"date\"});\r\n    const [elements, setElements] = useState([]);\r\n\r\n    const [displayEdit, setDisplayEdit] = useState(false);\r\n    const [displayAdd, setDisplayAdd] = useState(false);\r\n    const [elementId, setElementId] = useState();\r\n\r\n    const [voiceMode, setVoiceMode] = useState(false);\r\n\r\n    const history = useHistory();\r\n\r\n    useEffect(() => {\r\n        checkRoomId(roomId, setCategory, history, setVoiceMode);\r\n\r\n        getBasicData(history, setUserName, setAuthentication, setCatJson, \"chat\");\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (userName !== \"\")\r\n            socks.main(category, userName, setElement, setOnline, setOffline);\r\n    }, [userName]);\r\n\r\n    useEffect(() => {\r\n        setElements([...elements, element]);\r\n    }, [element]);\r\n\r\n    useEffect(() => {\r\n        let el = document.getElementById(\"last-element\");\r\n        el.scrollIntoView();\r\n    }, [elements]);\r\n\r\n    useEffect(() => {\r\n        if (online !== \"\"){\r\n            let new_offlineList = offlineList.filter(element => element !== online)\r\n            setOfflineList(new_offlineList);\r\n            setOnlineList([...onlineList, online]);\r\n        }\r\n    }, [online]);\r\n\r\n    useEffect(() => {\r\n        if (offline !== \"\"){\r\n            let new_onlineList = onlineList.filter(element => element !== offline)\r\n            setOnlineList(new_onlineList);\r\n            setOfflineList([...offlineList, offline]);\r\n        }\r\n    }, [offline]);\r\n\r\n    return (\r\n        <div className=\"chat\">\r\n            { displayEdit ?\r\n            <PopupEditCat\r\n                setDisplay={setDisplayEdit}\r\n                catjson={catjson}\r\n                setCatJson={setCatJson}\r\n                elementId={elementId}\r\n            /> : null\r\n            }\r\n            { displayAdd ?\r\n            <PopupAddCat\r\n                setDisplay={setDisplayAdd}\r\n                catjson={catjson}\r\n                setCatJson={setCatJson}\r\n            /> : null\r\n            }\r\n\r\n            <Categories/>\r\n            <Center/>\r\n            <StatusBar/>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default Chat;"]},"metadata":{},"sourceType":"module"}