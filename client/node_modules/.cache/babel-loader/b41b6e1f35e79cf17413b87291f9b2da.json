{"ast":null,"code":"import { Transport } from \"../transport.js\";\nimport yeast from \"yeast\";\nimport parseqs from \"parseqs\";\nimport { encodePayload, decodePayload } from \"engine.io-parser\";\nexport class Polling extends Transport {\n  constructor() {\n    super(...arguments);\n    this.polling = false;\n  }\n  /**\n   * Transport name.\n   */\n\n\n  get name() {\n    return \"polling\";\n  }\n  /**\n   * Opens the socket (triggers polling). We write a PING message to determine\n   * when the transport is open.\n   *\n   * @api private\n   */\n\n\n  doOpen() {\n    this.poll();\n  }\n  /**\n   * Pauses polling.\n   *\n   * @param {Function} callback upon buffers are flushed and transport is paused\n   * @api private\n   */\n\n\n  pause(onPause) {\n    this.readyState = \"pausing\";\n\n    const pause = () => {\n      this.readyState = \"paused\";\n      onPause();\n    };\n\n    if (this.polling || !this.writable) {\n      let total = 0;\n\n      if (this.polling) {\n        total++;\n        this.once(\"pollComplete\", function () {\n          --total || pause();\n        });\n      }\n\n      if (!this.writable) {\n        total++;\n        this.once(\"drain\", function () {\n          --total || pause();\n        });\n      }\n    } else {\n      pause();\n    }\n  }\n  /**\n   * Starts polling cycle.\n   *\n   * @api public\n   */\n\n\n  poll() {\n    this.polling = true;\n    this.doPoll();\n    this.emit(\"poll\");\n  }\n  /**\n   * Overloads onData to detect payloads.\n   *\n   * @api private\n   */\n\n\n  onData(data) {\n    const callback = packet => {\n      // if its the first message we consider the transport open\n      if (\"opening\" === this.readyState && packet.type === \"open\") {\n        this.onOpen();\n      } // if its a close packet, we close the ongoing requests\n\n\n      if (\"close\" === packet.type) {\n        this.onClose();\n        return false;\n      } // otherwise bypass onData and handle the message\n\n\n      this.onPacket(packet);\n    }; // decode payload\n\n\n    decodePayload(data, this.socket.binaryType).forEach(callback); // if an event did not trigger closing\n\n    if (\"closed\" !== this.readyState) {\n      // if we got data we're not polling\n      this.polling = false;\n      this.emit(\"pollComplete\");\n\n      if (\"open\" === this.readyState) {\n        this.poll();\n      } else {}\n    }\n  }\n  /**\n   * For polling, send a close packet.\n   *\n   * @api private\n   */\n\n\n  doClose() {\n    const close = () => {\n      this.write([{\n        type: \"close\"\n      }]);\n    };\n\n    if (\"open\" === this.readyState) {\n      close();\n    } else {\n      // in case we're trying to close while\n      // handshaking is in progress (GH-164)\n      this.once(\"open\", close);\n    }\n  }\n  /**\n   * Writes a packets payload.\n   *\n   * @param {Array} data packets\n   * @param {Function} drain callback\n   * @api private\n   */\n\n\n  write(packets) {\n    this.writable = false;\n    encodePayload(packets, data => {\n      this.doWrite(data, () => {\n        this.writable = true;\n        this.emit(\"drain\");\n      });\n    });\n  }\n  /**\n   * Generates uri for connection.\n   *\n   * @api private\n   */\n\n\n  uri() {\n    let query = this.query || {};\n    const schema = this.opts.secure ? \"https\" : \"http\";\n    let port = \"\"; // cache busting is forced\n\n    if (false !== this.opts.timestampRequests) {\n      query[this.opts.timestampParam] = yeast();\n    }\n\n    if (!this.supportsBinary && !query.sid) {\n      query.b64 = 1;\n    } // avoid port if default for schema\n\n\n    if (this.opts.port && (\"https\" === schema && Number(this.opts.port) !== 443 || \"http\" === schema && Number(this.opts.port) !== 80)) {\n      port = \":\" + this.opts.port;\n    }\n\n    const encodedQuery = parseqs.encode(query);\n    const ipv6 = this.opts.hostname.indexOf(\":\") !== -1;\n    return schema + \"://\" + (ipv6 ? \"[\" + this.opts.hostname + \"]\" : this.opts.hostname) + port + this.opts.path + (encodedQuery.length ? \"?\" + encodedQuery : \"\");\n  }\n\n}","map":{"version":3,"names":["Transport","yeast","parseqs","encodePayload","decodePayload","Polling","constructor","arguments","polling","name","doOpen","poll","pause","onPause","readyState","writable","total","once","doPoll","emit","onData","data","callback","packet","type","onOpen","onClose","onPacket","socket","binaryType","forEach","doClose","close","write","packets","doWrite","uri","query","schema","opts","secure","port","timestampRequests","timestampParam","supportsBinary","sid","b64","Number","encodedQuery","encode","ipv6","hostname","indexOf","path","length"],"sources":["/home/giorgir/Desktop/web projects/discord-mern/client/node_modules/engine.io-client/build/esm/transports/polling.js"],"sourcesContent":["import { Transport } from \"../transport.js\";\nimport yeast from \"yeast\";\nimport parseqs from \"parseqs\";\nimport { encodePayload, decodePayload } from \"engine.io-parser\";\nexport class Polling extends Transport {\n    constructor() {\n        super(...arguments);\n        this.polling = false;\n    }\n    /**\n     * Transport name.\n     */\n    get name() {\n        return \"polling\";\n    }\n    /**\n     * Opens the socket (triggers polling). We write a PING message to determine\n     * when the transport is open.\n     *\n     * @api private\n     */\n    doOpen() {\n        this.poll();\n    }\n    /**\n     * Pauses polling.\n     *\n     * @param {Function} callback upon buffers are flushed and transport is paused\n     * @api private\n     */\n    pause(onPause) {\n        this.readyState = \"pausing\";\n        const pause = () => {\n            this.readyState = \"paused\";\n            onPause();\n        };\n        if (this.polling || !this.writable) {\n            let total = 0;\n            if (this.polling) {\n                total++;\n                this.once(\"pollComplete\", function () {\n                    --total || pause();\n                });\n            }\n            if (!this.writable) {\n                total++;\n                this.once(\"drain\", function () {\n                    --total || pause();\n                });\n            }\n        }\n        else {\n            pause();\n        }\n    }\n    /**\n     * Starts polling cycle.\n     *\n     * @api public\n     */\n    poll() {\n        this.polling = true;\n        this.doPoll();\n        this.emit(\"poll\");\n    }\n    /**\n     * Overloads onData to detect payloads.\n     *\n     * @api private\n     */\n    onData(data) {\n        const callback = packet => {\n            // if its the first message we consider the transport open\n            if (\"opening\" === this.readyState && packet.type === \"open\") {\n                this.onOpen();\n            }\n            // if its a close packet, we close the ongoing requests\n            if (\"close\" === packet.type) {\n                this.onClose();\n                return false;\n            }\n            // otherwise bypass onData and handle the message\n            this.onPacket(packet);\n        };\n        // decode payload\n        decodePayload(data, this.socket.binaryType).forEach(callback);\n        // if an event did not trigger closing\n        if (\"closed\" !== this.readyState) {\n            // if we got data we're not polling\n            this.polling = false;\n            this.emit(\"pollComplete\");\n            if (\"open\" === this.readyState) {\n                this.poll();\n            }\n            else {\n            }\n        }\n    }\n    /**\n     * For polling, send a close packet.\n     *\n     * @api private\n     */\n    doClose() {\n        const close = () => {\n            this.write([{ type: \"close\" }]);\n        };\n        if (\"open\" === this.readyState) {\n            close();\n        }\n        else {\n            // in case we're trying to close while\n            // handshaking is in progress (GH-164)\n            this.once(\"open\", close);\n        }\n    }\n    /**\n     * Writes a packets payload.\n     *\n     * @param {Array} data packets\n     * @param {Function} drain callback\n     * @api private\n     */\n    write(packets) {\n        this.writable = false;\n        encodePayload(packets, data => {\n            this.doWrite(data, () => {\n                this.writable = true;\n                this.emit(\"drain\");\n            });\n        });\n    }\n    /**\n     * Generates uri for connection.\n     *\n     * @api private\n     */\n    uri() {\n        let query = this.query || {};\n        const schema = this.opts.secure ? \"https\" : \"http\";\n        let port = \"\";\n        // cache busting is forced\n        if (false !== this.opts.timestampRequests) {\n            query[this.opts.timestampParam] = yeast();\n        }\n        if (!this.supportsBinary && !query.sid) {\n            query.b64 = 1;\n        }\n        // avoid port if default for schema\n        if (this.opts.port &&\n            ((\"https\" === schema && Number(this.opts.port) !== 443) ||\n                (\"http\" === schema && Number(this.opts.port) !== 80))) {\n            port = \":\" + this.opts.port;\n        }\n        const encodedQuery = parseqs.encode(query);\n        const ipv6 = this.opts.hostname.indexOf(\":\") !== -1;\n        return (schema +\n            \"://\" +\n            (ipv6 ? \"[\" + this.opts.hostname + \"]\" : this.opts.hostname) +\n            port +\n            this.opts.path +\n            (encodedQuery.length ? \"?\" + encodedQuery : \"\"));\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}